<div class="projects-section-header">
  <h3 style="margin-bottom: 25px; font-weight: bold;" class="tit_page">Ordenes de Trabajo
  </h3>
</div>

<div class="row" id="cifras" *ngIf="contadorOrdenes">
  <div class="col-md-4">
    <h4>{{contadorOrdenes.en_Proceso}}</h4>
    <h6>En Proceso</h6>
  </div>
  <div class="col-md-4" id="pa1">
    <h4>{{contadorOrdenes.completados}}</h4>
    <h6>Completados</h6>
  </div>
  <div class="col-md-4" id="pa2">
    <h4>{{contadorOrdenes.totales}}</h4>
    <h6>Ordenes totales</h6>
  </div>
</div>
<div class="row" id="indicadores">

  <div class="row">
    <div class="col-md-1" id="ad">
      <button type="button" class="btn btn-success mb-3" (click)='getProyectos(); getUsuariosSelect(); '
        data-bs-toggle="modal" data-bs-target="#exampleModal1"
        style="border-radius: 20px !important; width: 160px; font-family: Arial, Helvetica, sans-serif;">
        <i class="fas fa-plus-circle"></i> &nbsp; <strong>Nueva Orden</strong>
      </button>
    </div>
  </div>
</div>
<div class="row" id="ordeneli">
  <div class="col-sm-4" *ngFor="let orden of ordenes">
    <div class="card text-black mb-3 panel-4" style="max-width: 25rem;">
      <div class="card-body">
        <p class="project-box-header-conse">Consecutivo: {{ orden.orden_consecutivo }}</p>
        <div class="dropdown dropdown-orden">
          <button class="btn project-btn-more" type="button" role="button" id="dropdownMenuLink"
            data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-ellipsis-v" data-toggle="tooltip" data-placement="top" title=""
              data-original-title="Actions">
            </i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
            <li>
              <a class="dropdown-item" href="#"
                (click)="getImplementosOrdenes(orden.id); getImplementosOrdenHistorial(orden.id)" data-bs-toggle="modal"
                data-bs-target="#implementosModal"><i class="fas fa-tools" title="Implementos"></i>
                Implementos</a>
            </li>
            <li>
              <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#detallesOrden"
                (click)="getDetallesOrden(orden.id)"><i class="fas fa-eye"></i> Ver detalles</a>
            </li>
            <li>
              <a class="dropdown-item" [routerLink]="['/informes-ordenes', orden.id]"><i
                  class="fas fa-clipboard-list"></i> Ver Informes</a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li>
              <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#editarOrden"
                (click)="getOrden(orden.id); getProyectos()"><i class="fas fa-pencil-alt"></i>
                Editar</a>
            </li>
            <li>
              <a class="dropdown-item text-danger" (click)="deleteOrden(orden.id)"><i class="fas fa-trash">
                </i> Eliminar</a>
            </li>
          </ul>
        </div>
        <h4 class="card-title text-center">{{orden.subProyecto}}</h4>
        <h6 style="text-align: center; margin-bottom: 15px;" class="card-subtitle">{{orden.proyecto}}</h6>
        <label for="" style="font-weight: bold;" class="box-progress-header">Progreso</label>
        <div class="progress" style="height: 4px !important;">
          <div class="progress-bar" style="height: 4px !important;" role="progressbar"
            style="background-color: rgb(250, 189, 59); width: 0%;" aria-valuenow="0" aria-valuemin="0"
            aria-valuemax="100"></div>
        </div>
        <p class="box-progress-percentage">0%</p>
      </div>
      <div class="card-footer">
        <div class="project-box-footer">
          <div class="participants">
            <img *ngFor="let element of orden.Usuarios_Json" src="{{url + '/image-user/'+ element.image}}"
              alt="participant">
            <button class="add-participant" style="color: #ff942e;"
              (click)="getUsuarioOrdenes(orden.id); getUsuariosSelectModal(); getUsuariosOrdenHistorial(orden.id)"
              data-bs-toggle="modal" data-bs-target="#usuariosModal" title="Agregar Usuario">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                class="feather feather-plus">
                <path d="M12 5v14M5 12h14"></path>
              </svg>
            </button>
          </div>
          <div class="days-left" style="color: #ff942e;">
            {{calculateDiff(orden.fecha_visita)}}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Agregar Nueva Orden de Trabajo</h5>
        <button type="button" class="btn-close btn-close-add" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form #FormAddOrden="ngForm" (ngSubmit)="addOrden()">
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6">

              <ng-select2 name="proyecto_id" [(ngModel)]="NuevaOrden.proyecto_id"
                (ngModelChange)="getSubProyectos($event)" [placeholder]="'Proyecto'" id="sele_proyec"
                [options]="optionsAddProyecto">
              </ng-select2>

            </div>
            <div class="col-md-6">
              <mat-form-field class="input_order" appearance="outline">
                <mat-label>Sub Proyecto</mat-label>
                <mat-select name="subproyecto_id" id="proyecto_id" (selectionChange)="SelectedValue($event)"
                  [(ngModel)]="NuevaOrden.subproyecto_id" #addSubProyectoOrden="ngModel" required>
                  <mat-option disabled>-- Seleccione --</mat-option>
                  <mat-option *ngFor="let subProyecto of subProyectos" value="{{subProyecto.id}}">{{subProyecto.nombre}}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>


          <div class="row">
            <div class="col-md-6">
              <mat-form-field class="input_order" appearance="outline">
                <mat-label>Fecha de Inicio del proyecto</mat-label>
                <input matInput [matDatepicker]="picker"
                [(ngModel)]="NuevaOrden.fecha_visita"
                name="fecha_visita"
                required autocomplete="off">
                <mat-hint>DD/MM/YYYY</mat-hint>
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
            </div>

            <div class="col-md-6">
              <mat-form-field class="input_order" appearance="outline">
                <mat-label>Lugar de Inspección</mat-label>
                <input matInput
                  [(ngModel)]="NuevaOrden.lugar_visita" name="lugar_visita"
                [placeholder]="'Ingrese el lugar de la inspección'"
                  autocomplete="off" required>
              </mat-form-field>
            </div>
          </div><br>

          <div class="row">
            <div class="col-md-12">
              <mat-form-field class="input_order_cons" appearance="outline">
                <mat-label>Consecutivo</mat-label>
                <input matInput [(ngModel)]="NuevaOrden.orden_consecutivo"
                  name="orden_consecutivo"
                [placeholder]="'Ingrese el consecutivo'"
                  autocomplete="off" required>
              </mat-form-field>
            </div>
          </div>
          <hr style="border-color: 2px solid black;">
          <div class="row">
            <div class="col-md-6" id="column1">
              <h5 class="text-center" class="tit_inf" id="inf1"><strong>1. Información de los Implementos</strong></h5>
              <br>
              <div class="row">
                <div class="col-12">

                  <ng-select2 name="implemento_id" [(ngModel)]="newImplemento.implemento_id"
                    [placeholder]="'Seleccione un implemento'" id="implementoSelect" [options]="optionsAdd">
                  </ng-select2>


                  <div *ngIf="errorImplementoAdd" class="alert alert-warning mt-3" role="alert">
                    {{errorImplementoAdd}}
                  </div>

                </div>
                <div class="col-12">
                  <button class="btn btn-outline-primary float-right" id="boton_anadir"
                    (click)="agregar_implemento()" type="button"><strong><i class="fas fa-plus-circle"></i>
                      Añadir</strong>
                  </button>

                  <div class="col-12">
                    <table id="implementos" style="box-shadow: none !important;" class="table table-hover">
                      <thead>
                        <tr>
                          <th><strong>#</strong></th>
                          <th><strong>Implemento</strong></th>
                          <th style="width: 40px;"><strong>Eliminar</strong></th>
                        </tr>
                      </thead>
                      <tbody id="zon">
                        <tr *ngFor="let implemento of implementosTable; let indice = index">
                          <td>{{ indice + 1 }}</td>
                          <td>{{implemento.implemento_name}}</td>
                          <td>
                            <button type="button" class="btn btn-danger btn-sm"
                              (click)="remover_implemento(implemento.id)">
                              X
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div class="form-group col-10" style="margin-left: 80px;">
                    </div>
                    <br><br>
                    <div class="row">
                      <div class="col-12">
                        <input type="hidden" name="Estado" class="form-control" id="Estado" value="1">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <br>
            </div>
            <div class="col-md-6" id="column2">
              <h5 class="text-center" class="tit_inf"><strong>2. Información de Inspectores</strong></h5>
              <br>
              <div class="row">
                <div class="col-md-6">
                  <mat-form-field class="input_order" appearance="outline">
                    <mat-label>Inspector</mat-label>
                    <mat-select name="usuario_id" id="usuarioSelect" (selectionChange)="SelectedValue($event)"
                      [(ngModel)]="newUsuario.Usuario_id">
                      <mat-option disabled>-- Seleccione --</mat-option>
                      <mat-option *ngFor="let usuario of usuarios" value="{{usuario.id}}">{{usuario.nombre_usuario}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="col-md-6">
                  <mat-form-field class="input_order" appearance="outline">
                    <mat-label>Fecha de visita</mat-label>
                    <mat-date-range-input [rangePicker]="rangoFechaVisita">
                      <input matStartDate placeholder="Fecha Inicial" name="starDate"
                        [(ngModel)]="newUsuario.fecha_inicial" autocomplete="off">
                      <input matEndDate placeholder="Fecha Final" name="endDate" [(ngModel)]="newUsuario.fecha_final"
                        autocomplete="off">
                    </mat-date-range-input>
                    <mat-datepicker-toggle matSuffix [for]="rangoFechaVisita"></mat-datepicker-toggle>
                    <mat-date-range-picker #rangoFechaVisita></mat-date-range-picker>
                  </mat-form-field>
                </div>
                <div *ngIf="errorUsuarioAdd" class="alert alert-warning mt-3" role="alert">
                  {{errorUsuarioAdd}}
                </div>
                <div class="col-12">
                  <button style="margin-top: 10px; margin-bottom: 23px;" class="btn btn-outline-primary float-right"
                    (click)="agregar_usuario()" id="boton_añadir" type="button"><strong><i
                        class="fas fa-plus-circle"></i>
                      Añadir</strong>
                  </button>
                </div>
                <br><br>
                <div class="col-12">
                  <table id="usuarios" class="table table-hover">
                    <thead>
                      <tr>
                        <th><strong>#</strong></th>
                        <th><strong>Nombre</strong></th>
                        <th><strong>Fecha de Inspección</strong></th>
                        <th style="width: 40px"><strong>Eliminar</strong></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let usuario of usuariosTable; let indic = index">
                        <td>{{ indic + 1 }}</td>
                        <td>{{usuario.usuario_name}}</td>
                        <td>{{usuario.fecha_inicial | date: 'dd/MM/yyyy' }} - {{usuario.fecha_final | date:
                          'dd/MM/yyyy'}}</td>
                        <td>
                          <button type="button" class="btn btn-danger btn-sm" (click)="remover_usuario(usuario.id)">
                            X
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <div class="form-group col-10" style="margin-left: 80px;">
                  </div>
                  <br><br>
                  <div class="row">
                    <div class="col-12">

                      <input type="hidden" name="Estado" class="form-control" id="Estado" value="1">
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancelar
          </button>
          <button type="submit" class="btn btn-success" [disabled]="!FormAddOrden.form.valid">
            Guardar Orden
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="editarOrden" tabindex="-1" aria-labelledby="editarOrdenLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modificar Orden de Trabajo</h5>
        <button type="button" class="btn-close btn-close-edit" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form #FormUpdateOrden="ngForm" (ngSubmit)="updateOrden()">
        <div class="modal-body">
          <div class="mb-3">
            <label for=""
              [ngClass]='{"errorLabel": ModificarProyectoOrden.invalid && (ModificarProyectoOrden.dirty || ModificarProyectoOrden.touched)}'><strong
                style="font-family: Arial, Helvetica, sans-serif;">Proyecto</strong></label>
            <select class="form-control" name="proyecto_id" id="proyecto_id" [(ngModel)]="EditarOrden.proyecto_id"
              (ngModelChange)="getSubProyectosEditar($event)" #ModificarProyectoOrden="ngModel"
              [ngClass]='{"errorForm": ModificarProyectoOrden.invalid && (ModificarProyectoOrden.dirty || ModificarProyectoOrden.touched)}'
              required>
              <option value="" disabled>-- Seleccione --</option>
              <option *ngFor="let proyecto of proyectos" value="{{proyecto.id}}">
                {{proyecto.nombre_proyecto}}</option>
            </select>
            <div id="perf"
              *ngIf="ModificarProyectoOrden.invalid && (ModificarProyectoOrden.dirty || ModificarProyectoOrden.touched) ">
              <div class="errorValidate" *ngIf="ModificarProyectoOrden.errors?.required">
                Seleccione una opción válida.
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for=""
              [ngClass]='{"errorLabel": ModificarSubProyectoOrden.invalid && (ModificarSubProyectoOrden.dirty || ModificarSubProyectoOrden.touched)}'><strong>SubProyecto</strong></label>
            <select class="form-control" name="subproyecto_id" id="subproyecto_id"
              [(ngModel)]="EditarOrden.subProyecto_id" #ModificarSubProyectoOrden="ngModel"
              [ngClass]='{"errorForm": ModificarSubProyectoOrden.invalid && (ModificarSubProyectoOrden.dirty || ModificarSubProyectoOrden.touched)}'
              required>
              <option disabled value="">-- Seleccione --</option>
              <option *ngFor="let subProyectoEditar of subProyectosEditar" value="{{subProyectoEditar.id}}">
                {{subProyectoEditar.nombre}}</option>
            </select>
            <div id="perf"
              *ngIf="ModificarSubProyectoOrden.invalid && (ModificarSubProyectoOrden.dirty || ModificarSubProyectoOrden.touched) ">
              <div class="errorValidate" *ngIf="ModificarSubProyectoOrden.errors?.required">
                Seleccione una opción válida.
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for=""
              [ngClass]='{"errorLabel": ModificarFechaInicioOrden.invalid && (ModificarFechaInicioOrden.dirty || ModificarFechaInicioOrden.touched)}'><strong>Fecha
                de Inicio del proyecto</strong></label>
            <input type="date" name="fecha_visita" class="form-control" [(ngModel)]="EditarOrden.fecha_visita"
              #ModificarFechaInicioOrden="ngModel"
              [ngClass]='{"errorForm": ModificarFechaInicioOrden.invalid && (ModificarFechaInicioOrden.dirty || ModificarFechaInicioOrden.touched)}'
              required />
            <div id="perf"
              *ngIf="ModificarFechaInicioOrden.invalid && (ModificarFechaInicioOrden.dirty || ModificarFechaInicioOrden.touched) ">
              <div class="errorValidate" *ngIf="ModificarFechaInicioOrden.errors?.required">
                Proporcione una fecha de inicio válida.
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for=""
              [ngClass]='{"errorLabel": ModificarLugarOrden.invalid && (ModificarLugarOrden.dirty || ModificarLugarOrden.touched)}'><strong>Lugar
                de Inspección</strong></label>
            <input type="text" name="lugar_visita" class="form-control" placeholder="Ingrese el lugar de la inspección"
              [(ngModel)]="EditarOrden.lugar_visita" #ModificarLugarOrden="ngModel"
              [ngClass]='{"errorForm": ModificarLugarOrden.invalid && (ModificarLugarOrden.dirty || ModificarLugarOrden.touched)}'
              autocomplete="off" required />
            <div id="perf"
              *ngIf="ModificarLugarOrden.invalid && (ModificarLugarOrden.dirty || ModificarLugarOrden.touched) ">
              <div class="errorValidate" *ngIf="ModificarLugarOrden.errors?.required">
                Proporcione un lugar de inspección válido.
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for=""
              [ngClass]='{"errorLabel": orden_consecutivo.invalid && (orden_consecutivo.dirty || orden_consecutivo.touched)}'><strong>Consecutivo</strong></label>
            <input type="number" name="orden_consecutivo" class="form-control"
              [(ngModel)]="EditarOrden.orden_consecutivo" #orden_consecutivo="ngModel"
              [ngClass]='{"errorForm": orden_consecutivo.invalid && (orden_consecutivo.dirty || orden_consecutivo.touched)}'
              required />
            <div id="perf" *ngIf="orden_consecutivo.invalid && (orden_consecutivo.dirty || orden_consecutivo.touched) ">
              <div class="errorValidate" *ngIf="orden_consecutivo.errors?.required">
                Proporcione un consecutivo válido.
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancelar
          </button>
          <button type="submit" class="btn btn-success" [disabled]="!FormUpdateOrden.form.valid">
            Modificar Orden
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="usuariosModal" tabindex="-1" aria-labelledby="usuariosModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="usuariosModalLabel">Usuarios</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form #FormaddUsuarioOrden="ngForm" (ngSubmit)="
      statusEditAndSubmit == true ? onSubmitEditUsuario() :
      addUsuarioOrden()">
        <div class="modal-body">
          <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
              <button class="nav-link active" id="nav-usuarios-tab" data-bs-toggle="tab" data-bs-target="#nav-usuarios"
                type="button" role="tab" aria-controls="nav-home" aria-selected="true">Usuarios</button>
              <button class="nav-link" id="nav-historial-tab" data-bs-toggle="tab" data-bs-target="#nav-historial"
                type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Historial</button>
            </div>
          </nav>
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-usuarios" role="tabpanel" aria-labelledby="nav-home-tab">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>
                      <select name="usuario_id" id="usuario_id" class="form-control" [(ngModel)]="addUsuario.usuario_id"
                        #AddUsuarioOrden="ngModel"
                        [ngClass]='{"errorForm": AddUsuarioOrden.invalid && (AddUsuarioOrden.dirty || AddUsuarioOrden.touched)}'
                        required>
                        <option selected disabled value="">--Seleccione--</option>
                        <option *ngFor="let usuario of usuariosModal" value="{{usuario.id}}">
                          {{usuario.nombre_usuario}}</option>
                      </select>
                      <div id="perf"
                        *ngIf="AddUsuarioOrden.invalid && (AddUsuarioOrden.dirty || AddUsuarioOrden.touched) ">
                        <div class="errorValidate" *ngIf="AddUsuarioOrden.errors?.required">
                          Seleccione una opción válida.
                        </div>
                      </div>
                    </th>
                    <th>
                      <mat-form-field class="example-form-field" appearance="outline">
                        <mat-label>Fecha</mat-label>
                        <mat-date-range-input [rangePicker]="campaignTwoPicker">
                          <input matStartDate placeholder="Fecha Inicial" name="starDate"
                            [(ngModel)]="addUsuario.fecha_inicial">
                          <input matEndDate placeholder="Fecha Final" name="endDate"
                            [(ngModel)]="addUsuario.fecha_final">
                        </mat-date-range-input>
                        <mat-datepicker-toggle matSuffix [for]="campaignTwoPicker"></mat-datepicker-toggle>
                        <mat-date-range-picker #campaignTwoPicker></mat-date-range-picker>
                      </mat-form-field>
                      <!--   <div id="perf"
                        *ngIf="AddFechaVisitaUsuarioOrden.invalid && (AddFechaVisitaUsuarioOrden.dirty || AddFechaVisitaUsuarioOrden.touched) ">
                        <div class="errorValidate" *ngIf="AddFechaVisitaUsuarioOrden.errors?.required">
                          Proporcione una fecha válida.
                        </div>
                      </div> -->
                    </th>
                    <th>
                      <button type="submit" class="btn btn-sm btn-success" [disabled]="!FormaddUsuarioOrden.form.valid">
                        {{ statusEditAndSubmit == true ? 'Modificar' :
                        'Adicionar'}}
                      </button>
                      <button type="button" class="btn btn-sm btn-secondary" (click)="onEventClickUsuarioCancelar()"
                        *ngIf="statusEditAndSubmit == true">
                        cancelar
                      </button>
                    </th>
                  </tr>
                  <tr *ngIf="messageAddUsuario">
                    <td colspan="3">
                      <div class="alert alert-warning" role="alert">
                        {{ messageAddUsuario }}
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th>Nombre</th>
                    <th>Fecha de visita</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let usuario of usuariosOrdenes">
                    <td>{{usuario.nombre_usuario}}</td>
                    <td> {{usuario.fecha_inicial | date: 'dd/MM/yyyy'}} - {{usuario.fecha_final | date: 'dd/MM/yyyy'}}
                    </td>
                    <td>
                      <div class="dropdown">
                        <button class="btn btn-sm btn-icon" type="button" role="button" id="dropdownMenuLink"
                          data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="fas fa-ellipsis-h" data-toggle="tooltip" data-placement="top" title=""
                            data-original-title="Actions"></i>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                          <li>
                            <a class="dropdown-item  user-click" (click)="deleteUsuarioOrden(usuario.id)"><i
                                class="fas fa-trash text-danger"></i>
                              Eliminar</a>
                            <a class="dropdown-item  user-click" (click)="onEventClickUsuario(usuario)">
                              <i class="fas fa-edit text-warning"></i>
                              Modificar
                            </a>
                          </li>
                        </ul>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="tab-pane fade" id="nav-historial" role="tabpanel" aria-labelledby="nav-profile-tab">

              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Fecha de visita</th>
                    <th>Fecha de eliminación</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let usuarioHistorial of usuariosOrdenesHistorial">
                    <td>{{usuarioHistorial.nombre_usuario}}</td>
                    <td>{{usuarioHistorial.fecha_visita | date: 'dd/MM/yyyy'}} </td>
                    <td>{{usuarioHistorial.update_at | date: 'dd/MM/yyyy h:mm a'}} </td>
                  </tr>
                </tbody>
              </table>

            </div>
          </div>



        </div>
      </form>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="implementosModal" tabindex="-1" aria-labelledby="implementosModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="implementosModalLabel">Implementos</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <form (ngSubmit)="saveImplemento()" #implemento="ngForm">
        <div class="modal-body">
          <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
              <button class="nav-link active" id="nav-implementos-tab" data-bs-toggle="tab"
                data-bs-target="#nav-implementos" type="button" role="tab" aria-controls="nav-implementos"
                aria-selected="true">Implementos</button>
              <button class="nav-link" id="nav-implementosHistorial-tab" data-bs-toggle="tab"
                data-bs-target="#nav-implementosHistorial" type="button" role="tab"
                aria-controls="nav-implementosHistorial" aria-selected="false">Historial</button>
            </div>
          </nav>
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-implementos" role="tabpanel"
              aria-labelledby="nav-implementos-tab">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <td colspan="4">

                      <ng-select2 name="implemento_id" [(ngModel)]="addImplemento.implemento_id"
                        [placeholder]="'Seleccione un implemento'" [options]="optionsAddImplemento"></ng-select2>
                      <div id="perf" *ngIf="errorImplemento">
                        <div class="errorValidate">
                          Seleccione una opción válida.
                        </div>
                      </div>
                    </td>
                    <td>
                      <button type="submit" class="btn btn-sm btn-success">
                        Adicionar
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <th>Nombre</th>
                    <th>Serial</th>
                    <th>Codigo N</th>
                    <th>Modelo</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let implemento of implementosOrdenes">
                    <td>{{implemento.nombre_implemento}}</td>
                    <td>{{implemento.serial}}</td>
                    <td>{{implemento.codigo_n}}</td>
                    <td>{{implemento.modelo}}</td>
                    <td>
                      <div class="dropdown">
                        <button class="btn btn-sm btn-icon" type="button" role="button" id="dropdownMenuLink"
                          data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="fas fa-ellipsis-h" data-toggle="tooltip" data-placement="top" title=""
                            data-original-title="Actions"></i>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                          <li>
                            <a class="dropdown-item text-danger"
                              (click)="deleteImplementoOrden(implemento.implemento_id)"><i class="fas fa-trash"></i>
                              Eliminar</a>
                          </li>
                        </ul>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="tab-pane fade" id="nav-implementosHistorial" role="tabpanel"
              aria-labelledby="nav-implementosHistorial-tab">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Serial</th>
                    <th>Codigo N</th>
                    <th>Modelo</th>
                    <th>Fecha de eliminación</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let implementoHistorial of implementosOrdenesHistorial">
                    <td>{{implementoHistorial.nombre_implemento}}</td>
                    <td>{{implementoHistorial.serial}}</td>
                    <td>{{implementoHistorial.codigo_n}}</td>
                    <td>{{implementoHistorial.modelo}}</td>
                    <td>{{implementoHistorial.update_at | date: 'dd/MM/yyyy h:mm a'}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </form>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="detallesOrden" tabindex="-1" aria-labelledby="detallesOrdenLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header modal-header-detalles">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="detmodal">
        <div class="row" id="det">
          <div class="col-md-4" id="detcol">
            <ul id="usuarioslist">

              <li *ngFor="let user of usuariosOrdenesDetalles">
                <span id="perf"><img src="{{url + '/image-user/'+ user.image}}" alt="participant"></span>

                <p>{{user.nombre_usuario}}</p>
              </li>

            </ul>
          </div>
          <div class="col-md-8" *ngIf="detallesOrdenes">
            <h6><strong style="color: rgb(35, 223, 192);">Consecutivo:</strong>
              {{detallesOrdenes.orden_consecutivo}} </h6>
            <h2 style="color: black;">{{detallesOrdenes.subProyecto}}</h2>
            <h5>{{detallesOrdenes.proyecto}}</h5>
            <hr>
            <div class="row">
              <div class="col-md-6">
                <p style="color: rgb(35, 223, 192); font-weight: bold;">UBICACIÓN</p>
                <p>{{detallesOrdenes.lugar_visita}}</p>
              </div>
              <div class="col-md-6">
                <p style="color: rgb(35, 223, 192); font-weight: bold;">FECHA</p>
                <p>{{detallesOrdenes.fecha_visita | date: 'mediumDate'}}</p>

              </div>
            </div>
            <google-map width="460" height="260"></google-map>
          </div>
        </div>
      </div>
      <div class="modal-footer modal-footer-detalles">
        <button type="button" class="btn btn-light  btn-close-detalles" data-bs-dismiss="modal">
          <strong>Cerrar</strong>
        </button>
      </div>
    </div>
  </div>
</div>
